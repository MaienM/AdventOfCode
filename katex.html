<!-- Based on https://github.com/drmingdrmer/math-in-rust-doc -->

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.5/dist/katex.min.css" integrity="sha384-JzZYylmwsQW/mzosimflHksK2k3GXCUi9MKWSj4R8C123trOprLxW8kTXkCx27vx" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.5/dist/katex.min.js"
integrity="sha384-ln7gG7tOY4cLmBcihVLqtNOlWe3w2+ayBobLDCNSdFEanAuMF+lPAntv5HEHEJuT" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.5/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

<script>
    "use strict";
    document.addEventListener("DOMContentLoaded", function () {
        var maths = document.getElementsByClassName("language-math");
        for (var i=0; i<maths.length; i++) {
            var el = maths[i];
            katex.render(el.innerText, el, {displayMode: true});
        }

        var codes = document.getElementsByTagName("code");
        for (i=0; i<codes.length; i++) {
            el = codes[i];
            if (el.classList.contains("language-math")) continue;
            if (el.classList.contains("language-inline-math")) {
                katex.render(el.innerText, el);
                continue;
            }

            var parent = el.parentNode;
            if (parent.nodeName.toLowerCase() === "pre") continue;
            // TODO: Can this be done with DOM manipulation rather than string manipulation?
            // https://stackoverflow.com/q/48438067/3019990
            var inlineMath = "$" + el.outerHTML + "$";
            if (parent.innerHTML.indexOf(inlineMath) !== -1) {
                el.classList.add("language-inline-math");
                parent.innerHTML = parent.innerHTML.replace("$" + el.outerHTML + "$", el.outerHTML);
                i--;
            }
        }
    });
</script>

<style type="text/css" media="screen">
    /* Left-align */
    .katex-display, .katex-display > .katex {
        text-align: left;
    }

    /* Remove excessive padding. */
    .katex-display, .katex-display > .katex {
        margin: 0;
    }

    /* Increase spacing between lines. */
    .katex-display .katex .newline:not(:last-child) {
        height: 0.5em;
    }
</style>
